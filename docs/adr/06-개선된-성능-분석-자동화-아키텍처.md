# 개선된 성능 분석 자동화 아키텍처

Date: 2025-10-14
Status: Accepted

## 맥락

[ADR-04](./04-performance-analysis-plan.md)에서 수립된 성능 분석 계획에 따라 프로파일링 데이터 수집 및 기본 분석이 가능해졌습니다. 하지만 다음과 같은 한계점이 존재했습니다.

1.  **평면적인 분석 데이터:** 모든 프로파일링 데이터가 동일한 레벨에서 수집되어, 전체 파이프라인(`Placement` → `Routing` → `Post-Process`)과 그 내부의 세부 모듈 간의 관계를 파악하기 어려웠습니다.
2.  **수동적인 리포트 생성:** 분석 결과를 리포트로 만드는 과정이 수동적이어서 비효율적이고, 결과의 일관성을 유지하기 어려웠습니다.
3.  **경직된 분석 로직:** 분석 기준이나 대상 시나리오가 스크립트 내에 하드코딩되어 있어, 변경 및 확장이 유연하지 못했습니다.

이러한 문제를 해결하고 분석의 깊이와 효율성을 높이기 위해, Python 기반의 새로운 분석 자동화 아키텍처를 도입합니다.

## 결정

분석 파이프라인을 고도화하기 위해 **계층적 성능 측정**, **설정 파일 기반 분석**, **템플릿 기반 리포트 자동 생성**의 세 가지 핵심 요소를 도입합니다.

### 1. 계층적 성능 측정 (Hierarchical Measurement)

- **문제점:** 기존의 평면적인 데이터 구조는 병목 현상의 상위 원인과 하위 원인을 단계적으로 추적하기 어렵게 만듭니다.
- **해결책:** [measurement_levels.md](../measurement_levels.md)에 정의된 `L{level}-{path}` 명명 규칙을 프로파일러에 적용합니다. 이를 통해 측정 데이터를 `L1 (전체 단계) → L2 (주요 모듈) → L3 (세부 함수)`와 같이 계층적으로 구조화하여 드릴다운(drill-down) 분석이 가능하도록 합니다.

### 2. 설정 파일 기반 분석 (Configuration-driven Analysis)

- **문제점:** 분석 로직이 코드에 직접 포함되어 있어, 시나리오 추가나 분석 단계 변경 시 코드를 수정해야 하는 번거로움이 있었습니다.
- **해결책:** `analysis/config.yaml` 파일을 도입하여 분석 대상을 설정으로 분리합니다. 최상위 분석 단계(L1), 대상 시나리오, 각종 포맷팅 규칙 등을 외부에서 주입할 수 있어 분석의 유연성과 확장성이 크게 향상됩니다. 특히, 리포트에 사용되는 모든 수치 데이터는 **소수점 둘째 자리까지** 표시하도록 서식 규칙을 설정하여 결과의 일관성을 보장합니다.

### 3. 템플릿 기반 리포트 자동 생성 (Template-based Reporting)

- **문제점:** 수동 리포트 작성은 시간이 많이 소요되고, 분석가마다 형식이나 내용의 편차가 발생할 수 있습니다.
- **해결책:** Python의 `Jinja2` 라이브러리와 `report_frame.md.j2` 템플릿을 사용하여 분석 결과를 표준화된 마크다운 리포트로 자동 생성합니다. 분석된 데이터(통계 테이블, 차트 이미지 경로 등)가 템플릿에 자동으로 채워져 일관성 있고 재현 가능한 리포트를 빠르게 얻을 수 있습니다.

--- 

## 새로운 분석 워크플로우

1.  **데이터 수집:** `run-benchmark.ts` 스크립트를 실행하여 `L{level}` 규칙에 따라 구조화된 프로파일링 데이터(JSON)를 수집합니다. (기존과 동일)
2.  **분석 실행:** `python analysis/analyzer.py` 스크립트를 실행합니다.
3.  **설정 로드:** `analyzer.py`는 `analysis/config.yaml` 파일을 읽어 분석에 필요한 설정을 로드합니다.
4.  **계층적 분석:** 수집된 JSON 데이터를 파싱하고, `L{level}` 키를 기준으로 데이터를 계층적으로 분석합니다. `pandas`를 사용하여 통계치를 계산하고, `matplotlib`으로 시각화 차트를 생성합니다.
5.  **리포트 생성:** 분석된 데이터와 생성된 차트의 경로를 `Jinja2` 템플릿(`report_frame.md.j2`)에 주입하여, 지정된 경로에 최종 마크다운 리포트(`report_frame.md`)를 생성합니다.

## 기대 결과

- **분석 깊이 향상:** 병목 구간을 상위 단계부터 세부 함수까지 단계적으로 추적하여 근본 원인을 더 명확하게 규명할 수 있습니다.
- **분석 효율성 증대:** 전체 리포트 생성 과정이 자동화되어, 반복적인 분석 작업에 소요되는 시간을 획기적으로 단축합니다.
- **유연성 및 확장성 확보:** 새로운 분석 지표나 리포트 형식을 코드 변경 없이 설정을 통해 쉽게 추가하거나 변경할 수 있어, 지속 가능한 성능 관리 체계를 구축할 수 있습니다.
